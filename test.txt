A context manager from scratch